<!--pages/posts-detail/posts-detail.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å¸–å­è¯¦æƒ… -->
  <view wx:else class="post-detail">
    <!-- å¸–å­å†…å®¹ -->
    <view class="post-card">
      <view class="post-header">
        <image class="user-avatar" src="{{post.avatar}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="user-name">{{post.nickname}}</text>
          <text class="post-time">{{post.createTime}}</text>
        </view>
        <view class="post-meta">
          <text class="location">{{post.location}}</text>
          <text class="insect-name">{{post.insectName}}</text>
        </view>
      </view>

      <view class="post-content">
        <text class="content-text">{{post.content}}</text>
      </view>

      <view wx:if="{{post.imageUrl}}" class="post-image">
        <image class="content-image" src="{{post.imageUrl}}" mode="aspectFit"></image>
      </view>

      <view class="post-stats">
        <view class="stat-item">
          <text class="stat-icon">ğŸ‘ï¸</text>
          <text class="stat-text">{{post.viewCount}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ’¬</text>
          <text class="stat-text">{{post.commentCount}}</text>
        </view>
        <button 
          class="like-btn {{liked ? 'liked' : ''}}" 
          bindtap="likePost"
        >
          <text class="like-icon">{{liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="like-text">{{post.likeCount}}</text>
        </button>
      </view>
    </view>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comments-section">
      <view class="section-title">
        <text>è¯„è®º ({{post.commentCount}})</text>
      </view>
      
      <view wx:if="{{comments.length === 0}}" class="no-comments">
        <text>æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§~</text>
      </view>

      <view wx:else class="comments-list">
        <view wx:for="{{comments}}" wx:key="id" class="comment-item">
          <image class="comment-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-name">{{item.nickname}}</text>
              <text class="comment-time">{{item.createTime}}</text>
            </view>
            <text class="comment-text">{{item.content}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯„è®ºè¾“å…¥æ¡† -->
    <view class="comment-input-bar">
      <view class="input-wrapper">
        <input 
          class="comment-input" 
          placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." 
          value="{{commentInput}}"
          bindinput="onCommentInput"
          confirm-type="send"
          bindconfirm="submitComment"
        />
        <button class="emoji-btn" bindtap="toggleEmojiPicker">ğŸ˜Š</button>
      </view>
      <button 
        class="submit-btn {{submitting ? 'loading' : ''}}" 
        bindtap="submitComment"
        disabled="{{submitting}}"
      >
        {{submitting ? 'å‘é€ä¸­...' : 'å‘é€'}}
      </button>
    </view>

    <!-- è¡¨æƒ…é€‰æ‹©å™¨ -->
    <view wx:if="{{showEmojiPicker}}" class="emoji-picker-mask" bindtap="toggleEmojiPicker">
      <view class="emoji-picker" catchtap="stopPropagation">
        <view class="emoji-title">é€‰æ‹©è¡¨æƒ…</view>
        <view class="emoji-grid">
          <view 
            wx:for="{{emojis}}" 
            wx:key="index" 
            class="emoji-item" 
            bindtap="selectEmoji"
            data-emoji="{{item}}"
          >
            <text>{{item}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

