<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="header">
    <view class="header-title">
      {{historyType === 'watch' ? 'è§‚çœ‹è®°å½•ç®¡ç†' : (historyType === 'favorite' ? 'æ”¶è—è§†é¢‘ç®¡ç†' : 'æµè§ˆè®°å½•ç®¡ç†')}}
    </view>
    <view class="header-actions">
      <view class="action-btn" bindtap="toggleDeleteMode">
        <text>{{deleteMode ? 'å–æ¶ˆ' : 'åˆ é™¤'}}</text>
      </view>
    </view>
  </view>

  <!-- åˆ é™¤æ¨¡å¼æç¤º -->
  <view class="delete-tip" wx:if="{{deleteMode}}">
    <view class="delete-tip-left">
      <text>è¯·é€‰æ‹©è¦åˆ é™¤çš„è®°å½•ï¼ˆå·²é€‰æ‹© {{selectedItems.length}} æ¡ï¼‰</text>
    </view>
    <view class="delete-tip-right">
      <view class="select-all-btn" bindtap="toggleSelectAll">
        <text>{{isAllSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</text>
      </view>
      <view class="delete-confirm-btn" wx:if="{{selectedItems.length > 0}}" bindtap="deleteSelectedItems">
        <text>ç¡®è®¤åˆ é™¤</text>
      </view>
    </view>
  </view>

  <!-- æµè§ˆè®°å½•åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{historyType === 'browse' && browseHistory.length > 0}}">
    <view 
      wx:for="{{browseHistory}}" 
      wx:key="index" 
      wx:for-item="browseItem"
      wx:for-index="browseIndex"
      class="history-item {{deleteMode && selectedMap[browseIndex] ? 'selected' : ''}}"
      bindtap="goToDetail"
      data-index="{{browseIndex}}"
      data-item="{{browseItem}}"
    >
      <!-- åˆ é™¤æ¨¡å¼ï¼šæ˜¾ç¤ºé€‰æ‹©æ¡† -->
      <view class="select-checkbox" wx:if="{{deleteMode}}">
        <view class="checkbox {{selectedMap[browseIndex] ? 'checked' : ''}}">
          <text wx:if="{{selectedMap[browseIndex]}}">âœ“</text>
        </view>
      </view>
      
      <!-- æ˜†è™«å›¾ç‰‡ -->
      <image class="history-image" src="{{browseItem.image}}" mode="aspectFill" />
      
      <!-- æ˜†è™«ä¿¡æ¯ -->
      <view class="history-info">
        <text class="history-name">{{browseItem.name}}</text>
        <text class="history-time">{{formatBrowseTime(browseItem.browseTime)}}</text>
      </view>
      
      <!-- åˆ é™¤æ¨¡å¼ï¼šé«˜äº®æ˜¾ç¤º -->
      <view class="delete-overlay" wx:if="{{deleteMode && selectedMap[browseIndex]}}">
        <text>å·²é€‰ä¸­</text>
      </view>
    </view>
  </view>

  <!-- è§‚çœ‹è®°å½•åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{historyType === 'watch' && watchHistory.length > 0}}">
    <view 
      wx:for="{{watchHistory}}" 
      wx:key="index" 
      wx:for-item="watchItem"
      wx:for-index="watchIndex"
      class="history-item {{deleteMode && selectedMap[watchIndex] ? 'selected' : ''}}"
      bindtap="goToDetail"
      data-index="{{watchIndex}}"
      data-item="{{watchItem}}"
    >
      <!-- åˆ é™¤æ¨¡å¼ï¼šæ˜¾ç¤ºé€‰æ‹©æ¡† -->
      <view class="select-checkbox" wx:if="{{deleteMode}}">
        <view class="checkbox {{selectedMap[watchIndex] ? 'checked' : ''}}">
          <text wx:if="{{selectedMap[watchIndex]}}">âœ“</text>
        </view>
      </view>
      
      <!-- è§†é¢‘ç¼©ç•¥å›¾ -->
      <image class="history-image" src="{{watchItem.thumbnail}}" mode="aspectFill" />
      
      <!-- è§†é¢‘ä¿¡æ¯ -->
      <view class="history-info">
        <text class="history-name">{{watchItem.title}}</text>
        <text class="history-time">{{formatBrowseTime(watchItem.watchTime)}}</text>
      </view>
      
      <!-- åˆ é™¤æ¨¡å¼ï¼šé«˜äº®æ˜¾ç¤º -->
      <view class="delete-overlay" wx:if="{{deleteMode && selectedMap[watchIndex]}}">
        <text>å·²é€‰ä¸­</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—è§†é¢‘åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{historyType === 'favorite' && favoriteHistory.length > 0}}">
    <view 
      wx:for="{{favoriteHistory}}" 
      wx:key="index" 
      wx:for-item="favItem"
      wx:for-index="favIndex"
      class="history-item {{deleteMode && selectedMap[favIndex] ? 'selected' : ''}}"
      bindtap="goToDetail"
      data-index="{{favIndex}}"
      data-item="{{favItem}}"
    >
      <!-- åˆ é™¤æ¨¡å¼ï¼šæ˜¾ç¤ºé€‰æ‹©æ¡† -->
      <view class="select-checkbox" wx:if="{{deleteMode}}">
        <view class="checkbox {{selectedMap[favIndex] ? 'checked' : ''}}">
          <text wx:if="{{selectedMap[favIndex]}}">âœ“</text>
        </view>
      </view>
      
      <!-- è§†é¢‘ç¼©ç•¥å›¾ -->
      <image class="history-image" src="{{favItem.thumbnail}}" mode="aspectFill" />
      
      <!-- è§†é¢‘ä¿¡æ¯ -->
      <view class="history-info">
        <text class="history-name">{{favItem.title}}</text>
        <text class="history-time">{{formatBrowseTime(favItem.favoriteTime)}}</text>
      </view>
      
      <!-- åˆ é™¤æ¨¡å¼ï¼šé«˜äº®æ˜¾ç¤º -->
      <view class="delete-overlay" wx:if="{{deleteMode && selectedMap[favIndex]}}">
        <text>å·²é€‰ä¸­</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{(historyType === 'browse' && browseHistory.length === 0) || (historyType === 'watch' && watchHistory.length === 0) || (historyType === 'favorite' && favoriteHistory.length === 0)}}">
    <text class="empty-icon">
      {{historyType === 'watch' ? 'ğŸ¬' : (historyType === 'favorite' ? 'â­' : 'ğŸ”')}}
    </text>
    <text class="empty-text">
      è¿˜æ²¡æœ‰{{historyType === 'watch' ? 'è§‚çœ‹' : (historyType === 'favorite' ? 'æ”¶è—' : 'æµè§ˆ')}}è®°å½•
    </text>
  </view>
</view>
