<!--pages/posts/posts.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <view wx:else class="posts-container">
    <!-- å‘å¸ƒåŒºåŸŸ -->
    <view class="publish-section">
      <view class="publish-header">
        <text class="section-title">åˆ†äº«ä½ çš„å‘ç°</text>
      </view>
      
      <!-- å›¾ç‰‡é€‰æ‹© -->
      <view class="image-section">
        <view wx:if="{{!imageUrl}}" class="image-placeholder" bindtap="chooseImage">
          <text class="placeholder-icon">ğŸ“·</text>
          <text class="placeholder-text">ç‚¹å‡»æ·»åŠ ç…§ç‰‡</text>
        </view>
        <view wx:else class="image-preview">
          <image class="preview-image" src="{{imageUrl}}" mode="aspectFill"></image>
          <view class="image-actions">
            <button class="action-btn" bindtap="chooseImage">é‡æ–°é€‰æ‹©</button>
          </view>
        </view>
      </view>

      <!-- å†…å®¹è¾“å…¥ -->
      <view class="content-section">
        <textarea 
          class="content-input" 
          placeholder="åˆ†äº«ä½ çš„è§‚å¯Ÿå‘ç°..." 
          value="{{content}}"
          bindinput="onContentChange"
          maxlength="500"
        ></textarea>
        <text class="char-count">{{content.length}}/500</text>
      </view>

      <!-- å‘å¸ƒæŒ‰é’® -->
      <button 
        class="publish-btn {{submitting ? 'loading' : ''}}" 
        bindtap="submitPost"
        disabled="{{submitting}}"
      >
        {{submitting ? 'å‘å¸ƒä¸­...' : 'å‘å¸ƒ'}}
      </button>
    </view>

    <!-- å¸–å­åˆ—è¡¨ -->
    <view class="posts-list">
      <view wx:for="{{posts}}" wx:key="id" class="post-item">
        <view class="post-header">
          <image class="user-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="user-info">
            <text class="user-name">{{item.nickname}}</text>
            <text class="post-time">{{item.createTime}}</text>
          </view>
          <view class="post-meta">
            <text class="location">{{item.location}}</text>
            <text class="insect-name">{{item.insectName}}</text>
          </view>
        </view>

        <view class="post-content">
          <text class="content-text">{{item.content}}</text>
        </view>

        <view wx:if="{{item.imageUrl}}" class="post-image">
          <image class="content-image" src="{{item.imageUrl}}" mode="aspectFill"></image>
        </view>

        <view class="post-actions">
          <button 
            class="action-btn {{item.liked ? 'liked' : ''}}" 
            bindtap="likePost" 
            data-id="{{item.id}}"
          >
            <text class="action-icon">{{item.liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            <text class="action-text">{{item.likeCount}}</text>
          </button>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore}}" class="load-more">
      <text>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    </view>
    <view wx:else class="no-more">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </view>
</view>