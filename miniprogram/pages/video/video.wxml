<!--pages/video/video.wxml-->
<view class="container">
  <!-- 加载中 -->
  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <!-- 视频播放器 -->
  <view wx:else class="video-container">
    <!-- 视频播放器 -->
    <view class="video-wrapper">
      <video 
        id="video-player"
        class="video-player {{fullscreen ? 'fullscreen' : ''}}"
        src="{{videoInfo.video_url}}"
        poster="{{videoInfo.thumbnail_url}}"
        bindplay="onVideoPlay"
        bindpause="onVideoPause"
        bindtimeupdate="onVideoTimeUpdate"
        bindended="onVideoEnded"
        bindfullscreenchange="onFullscreenChange"
        bindtap="onVideoOverlayTap"
        vslide-gesture-in-fullscreen="{{true}}"
        controls
        show-center-play-btn
        enable-progress-gesture
        show-fullscreen-btn="{{true}}"
        enable-play-gesture="{{true}}"
        object-fit="contain"
      ></video>
      <!-- 浮动全屏按钮（cover-view 才能盖在原生 video 上） -->
      <!-- 注释掉自定义按钮，使用video组件自带的全屏按钮更稳定 -->
      <!-- <cover-view class="fs-fab" bindtap="toggleFullscreen">
        {{ fullscreen ? '退出全屏' : '沉浸全屏' }}
      </cover-view> -->
      <!-- 暂停/播放提示（使用 cover-view 才能显示在视频上） -->
      <cover-view wx:if="{{showPauseIcon}}" class="pause-icon">
        {{ playing ? '▶' : '⏸' }}
      </cover-view>
      <!-- 全屏时左上角返回（使用 cover-view 才能显示在视频上） -->
      <cover-view wx:if="{{fullscreen}}" class="fullscreen-back" catchtap="onBackTap">
        ←
      </cover-view>
    </view>

    <!-- 视频信息 -->
    <view class="video-info">
      <view class="video-title">{{videoInfo.title}}</view>
      <view class="video-meta">
        <text class="insect-name">{{videoInfo.insect_name}}</text>
        <text class="duration">{{formatTime(videoInfo.duration_seconds || videoInfo.duration)}}</text>
        <text class="view-count">{{videoInfo.view_count || 0}} 次观看</text>
      </view>
      <view class="video-description">{{videoInfo.description}}</view>
    </view>

    <!-- 控制按钮 - 移除自定义全屏按钮，使用视频组件自带的全屏按钮 -->
    <!-- <view class="video-controls">
      <button class="control-btn single" bindtap="toggleFullscreen" disabled="{{fsBusy}}">
        {{fullscreen ? '退出全屏' : '沉浸全屏'}}
      </button>
    </view> -->

    <!-- 相关推荐 -->
    <view class="recommendations">
      <view class="section-title">相关视频</view>
      <view class="video-list">
        <block wx:for="{{relatedVideos}}" wx:key="id">
          <view class="recommend-item" data-id="{{item.id}}" bindtap="onRecommendTap">
            <image class="recommend-thumb" src="{{item.thumbnail_url}}" mode="aspectFill"></image>
            <view class="recommend-info">
              <text class="recommend-title">{{item.title}}</text>
              <text class="recommend-duration">{{formatTime(item.duration_seconds || item.duration)}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- 返回按钮 -->
  <view class="back-btn" bindtap="goBack">
    <text class="back-icon">←</text>
  </view>
</view>