<!--pages/observation/observation.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- è§‚å¯Ÿè®°å½•è¡¨å• -->
  <view wx:else class="form-container">
    <!-- æ˜†è™«ä¿¡æ¯ -->
    <view wx:if="{{insectInfo}}" class="insect-info">
      <image class="insect-image" src="{{insectInfo.child_image_url || insectInfo.adult_image_url}}" mode="aspectFit"></image>
      <view class="insect-details">
        <text class="insect-name">{{insectInfo.name}}</text>
        <text class="insect-type">{{insectInfo.type}}</text>
      </view>
    </view>

    <!-- è§‚å¯Ÿåœ°ç‚¹ -->
    <view class="form-item">
      <text class="label">è§‚å¯Ÿåœ°ç‚¹ *</text>
      <input 
        class="input" 
        placeholder="è¯·è¾“å…¥è§‚å¯Ÿåœ°ç‚¹" 
        value="{{observationData.location}}"
        bindinput="onInputChange"
        data-field="location"
      />
    </view>

    <!-- è§‚å¯Ÿæ—¶é—´ -->
    <view class="form-item">
      <text class="label">è§‚å¯Ÿæ—¶é—´ *</text>
      <picker 
        mode="multiSelector" 
        range="{{timeRange}}"
        bindchange="onTimeChange"
      >
        <view class="picker">
          {{observationData.time || 'è¯·é€‰æ‹©è§‚å¯Ÿæ—¶é—´'}}
        </view>
      </picker>
    </view>

    <!-- ç…§ç‰‡ -->
    <view class="form-item">
      <text class="label">è§‚å¯Ÿç…§ç‰‡</text>
      <view class="photo-section">
        <view wx:if="{{!observationData.photoUrl}}" class="photo-placeholder" bindtap="chooseImage">
          <text class="photo-icon">ğŸ“·</text>
          <text class="photo-text">ç‚¹å‡»æ·»åŠ ç…§ç‰‡</text>
        </view>
        <view wx:else class="photo-preview">
          <image class="preview-image" src="{{observationData.photoUrl}}" mode="aspectFill" bindtap="previewImage"></image>
          <view class="photo-actions">
            <button class="action-btn" bindtap="previewImage">é¢„è§ˆ</button>
            <button class="action-btn delete" bindtap="deleteImage">åˆ é™¤</button>
          </view>
        </view>
      </view>
    </view>

    <!-- è§‚å¯Ÿå¤‡æ³¨ -->
    <view class="form-item">
      <text class="label">è§‚å¯Ÿå¤‡æ³¨</text>
      <textarea 
        class="textarea" 
        placeholder="è®°å½•ä½ çš„è§‚å¯Ÿå‘ç°..." 
        value="{{observationData.notes}}"
        bindinput="onInputChange"
        data-field="notes"
        maxlength="500"
      ></textarea>
      <text class="char-count">{{observationData.notes.length}}/500</text>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <button 
        class="submit-btn {{submitting ? 'loading' : ''}}" 
        bindtap="submitObservation"
        disabled="{{submitting}}"
      >
        {{submitting ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜è§‚å¯Ÿè®°å½•'}}
      </button>
      <button class="cancel-btn" bindtap="goBack">å–æ¶ˆ</button>
    </view>
  </view>
</view>


